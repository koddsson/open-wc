<!doctype html>
<html>
  <head>
    <script type="module">
      import { ProviderElement } from '../../provider-element.ts';
      import { ConsumerElement } from '../../consumer-element.ts';

      window.customElements.define('server-state', class ServerState extends ProviderElement {});
      window.customElements.define('hit-count', class HitCount extends ConsumerElement { });
    </script>
  </head>
  <body>
    <server-state>
      <hit-count>
        Loading...
      </hit-count>
    </server-state>

    <script type="module">
      import { runTests } from "@web/test-runner-mocha";
      import { expect } from "chai";
      import { waitUntil } from '@open-wc/testing';

      runTests(() => {
        it("subscribes to changes", async () => {
          const provider = document.querySelector('server-state');
          const el = document.querySelector('hit-count');
          await waitUntil(() => el.textContent.trim() !== 'Loading...');
          expect(el.textContent).to.equal('9001 hits!');
         
          provider.setAttribute('hit-count', 9002);
          await waitUntil(() => el.textContent.trim() !== '9001 hits!');
          expect(el.textContent).to.equal('9002 hits!');
        });
      });
    </script>
  </body>
</html>
